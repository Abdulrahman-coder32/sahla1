<div class="profile-container">
  <div class="profile-card">
    <!-- Header -->
    <div class="profile-header">
      <h1>الملف الشخصي</h1>
      <p>إدارة بياناتك الشخصية بسهولة وأمان</p>
    </div>

    <!-- Content -->
    <div class="profile-content">
      <!-- Loading -->
      <div *ngIf="loading" class="flex justify-center py-24">
        <div class="w-20 h-20 border-6 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
      </div>

      <!-- Main Content -->
      <div *ngIf="!loading">
        <!-- Toast Notification -->
        <div *ngIf="message" class="profile-toast" [class.profile-toast-success]="message.type === 'success'" [class.profile-toast-error]="message.type === 'error'">
          {{ message.text }}
        </div>

        <!-- Avatar مع Placeholder -->
        <div class="profile-avatar-wrapper text-center">
          <div class="relative inline-block">
            <div class="avatar-container">
              <!-- الصورة الحقيقية -->
              <img *ngIf="previewUrl"
                   [src]="previewUrl"
                   alt="صورة الملف الشخصي لـ {{ user.name || 'المستخدم' }}"
                   class="profile-avatar w-full h-full object-cover"
                   loading="lazy">

              <!-- Placeholder: أول حرفين من الاسم (حساب جديد أو default) -->
              <div *ngIf="!previewUrl"
                   class="avatar-placeholder flex items-center justify-center">
                <span class="initials">{{ getInitials() }}</span>
              </div>

              <!-- زر الكاميرا (يظهر فقط في وضع التعديل) -->
              <label class="profile-camera-btn" [class.hidden]="!isEditing">
                <i class="fas fa-camera"></i>
                <input type="file" accept="image/*" (change)="onFileSelected($event)" class="hidden">
              </label>
            </div>
          </div>

          <h2 class="profile-name mt-6 text-3xl font-bold text-gray-900">{{ user.name || 'المستخدم' }}</h2>
          <p class="profile-role mt-2 text-xl font-semibold flex items-center justify-center gap-3" [style.color]="user?.role === 'job_seeker' ? 'rgb(38,32,137)' : '#16a34a'">
            <i class="fas fa-user-tag"></i>
            {{ user.role === 'job_seeker' ? 'باحث عن عمل' : 'صاحب عمل' }}
          </p>
          <p class="profile-email mt-2 text-lg text-gray-600 flex items-center justify-center gap-3">
            <i class="fas fa-envelope"></i> {{ user.email }}
          </p>
        </div>

        <!-- Info Card -->
        <div class="profile-info-card mt-10">
          <h3 class="profile-info-title text-2xl font-bold text-gray-900 flex items-center gap-3">
            <i class="fas fa-info-circle"></i>
            معلومات الحساب
          </h3>
          <div class="profile-form-grid mt-6">
            <div>
              <label class="profile-label block text-lg font-medium text-gray-700 mb-2">الاسم الكامل</label>
              <input [(ngModel)]="user.name" [disabled]="!isEditing" class="profile-input w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200">
            </div>
            <div>
              <label class="profile-label block text-lg font-medium text-gray-700 mb-2">رقم الهاتف</label>
              <input [(ngModel)]="user.phone" [disabled]="!isEditing" placeholder="01xxxxxxxxx" class="profile-input w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200">
            </div>
            <div class="col-span-2">
              <label class="profile-label block text-lg font-medium text-gray-700 mb-2">نبذة تعريفية (اختياري)</label>
              <textarea [(ngModel)]="user.bio" [disabled]="!isEditing" rows="6" class="profile-input profile-textarea w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200" placeholder="اكتب نبذة قصيرة عن نفسك..."></textarea>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="profile-actions mt-12 flex flex-col sm:flex-row gap-6 justify-center">
          <button *ngIf="!isEditing" (click)="toggleEdit()" class="profile-btn profile-btn-edit px-10 py-4 text-xl font-bold">
            <i class="fas fa-edit mr-3"></i>
            تعديل الملف الشخصي
          </button>

          <div *ngIf="isEditing" class="flex flex-col sm:flex-row gap-6 w-full max-w-4xl">
            <button (click)="saveProfile()" [disabled]="saving" class="profile-btn profile-btn-save px-10 py-4 text-xl font-bold">
              <i class="fas fa-save mr-3" *ngIf="!saving"></i>
              <span *ngIf="saving">جاري الحفظ...</span>
              <span *ngIf="!saving">حفظ التغييرات</span>
            </button>
            <button (click)="cancelEdit()" class="profile-btn profile-btn-cancel px-10 py-4 text-xl font-bold">
              <i class="fas fa-times mr-3"></i>
              إلغاء
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
